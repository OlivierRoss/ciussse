<!DOCTYPE html>
<html lang="fr">
  <head>
    <title>Disponibilités des organismes communautaires</title>
    <link rel="stylesheet" href="style.css" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&family=Open+Sans&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.15/lodash.min.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-3.3.1/dt-1.10.20/r-2.2.3/rg-1.1.1/datatables.min.css"/>
    <script type="text/javascript" src="datatables.min.js"></script>
    <!--<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.3.1/dt-1.10.20/r-2.2.3/rg-1.1.1/datatables.min.js"></script>-->
  </head>
  <body>
    <header>
      <h1>Répertoire des services communautaires actifs de Sherbrooke</h1>
    </header>
    <section id="presentation">
      <h2>Présentation de l'outil</h2>
      <p>Ce répertoire se veut une liste aussi à jour que possible de tous les services communautaires qui sont disponibles sur le territoire de Sherbrooke.</p>
      <p>Pour obtenir plus d'information sur un organisme, appuyez simplement sur le nom de l'organisme et vous obtiendrez tous les renseignements nécessaires.</p>
    </section>
    <section id="section-table">
      <table id="table"> </table>
    </section>
    <footer>
      <p>Cet outil est une initiative du CIUSSSE, de la CDC - Sherbrooke et du ROC</p>
    </footer>
    <script type="text/javascript">

      window.onload = async function () {
        let response = await fetch("https://sheets.googleapis.com/v4/spreadsheets/1inmEtfz_sZeA1bI6n2y581WnwOm44B-KTAxhacw2vJY/values/'IGNORER - Données publiques'!A:H?key=AIzaSyAl3TfynOtVS2PQRKyJPWxJShQdESCvsy4");

        if (response.ok) { // if HTTP-status is 200-299
          // get the response body (the method explained below)
          let json = await response.json();
          let organismes = json.values.slice(1);

          // Trouver tous les secteurs
          let secteurs = _.map(organismes, (organisme) => {
            return organisme[0];
          });

          // Creer plusieurs tables
          /*_.each(secteurs, (secteur) => {
            var titre = document.createElement('h2');
            titre.innerHTML = secteur;
            document.getElementById("section-table").appendChild(titre);

            var table = document.createElement('table');
            table.id = 'table-' + secteur.toLocaleLowerCase();
            document.getElementById("section-table").appendChild(table);
          });*/

          // Ajouter les donnees pour chaque table
          $('#table').DataTable({
            responsive: true,
            paging: false,
            data: organismes,
            columns: json.values.slice(0, 1)[0].map((col) => { return {title: col} }),
            "columnDefs": [
              {
                "targets": [0],
                "visible": false,
                "searchable": false
              },
              {
                "targets": [1],
                //"width": '25%',
                responsivePriority: 1
              },
              {
                "targets": [2],
                //"width": '65%',
                responsivePriority: 2
              }
            ],
            language: {
              "sEmptyTable":     "Aucune donnée disponible dans le tableau",
              "sInfo":           "Affichage de l'élément _START_ à _END_ sur _TOTAL_ éléments",
              "sInfoEmpty":      "Affichage de l'élément 0 à 0 sur 0 élément",
              "sInfoFiltered":   "(filtré à partir de _MAX_ éléments au total)",
              "sInfoPostFix":    "",
              "sInfoThousands":  ",",
              "sLengthMenu":     "Afficher _MENU_ éléments",
              "sLoadingRecords": "Chargement...",
              "sProcessing":     "Traitement...",
              "sSearch":         "Rechercher :",
              "sZeroRecords":    "Aucun élément correspondant trouvé",
              "oPaginate": {
                "sFirst":    "Premier",
                "sLast":     "Dernier",
                "sNext":     "Suivant",
                "sPrevious": "Précédent"
              },
              "oAria": {
                "sSortAscending":  ": activer pour trier la colonne par ordre croissant",
                "sSortDescending": ": activer pour trier la colonne par ordre décroissant"
              },
              "select": {
                "rows": {
                  "_": "%d lignes sélectionnées",
                  "0": "Aucune ligne sélectionnée",
                  "1": "1 ligne sélectionnée"
                } 
              }
            }
        });
      } else {
        alert("HTTP-Error: " + response.status);
      }
    }
  </script>
  </body>
</html>
