<!DOCTYPE html>
<html lang="fr">
  <head>
    <title>Disponibilités des organismes communautaires</title>
    <link rel="stylesheet" href="style.css" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto&display=swap" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>


    <link href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
    <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css" rel="stylesheet">-->
    <!--<link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet">-->

    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <!--<script src="https://cdn.datatables.net/1.10.20/js/https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.15/lodash.min.js"></script>
  </head>
  <body>
    <header>
      <h1>COVID-19</h1>
    </header>
    <section id="approche">
      <p> Texte de presentation </p>
    </section>
    <section id="section-table">
      <table id="table"> </table>
    </section>
    <footer>
      <p>Cet outil est une initiative du CIUSSSE</p>
    </footer>
    <script type="text/javascript">

      window.onload = async function () {
        let response = await fetch("https://sheets.googleapis.com/v4/spreadsheets/1inmEtfz_sZeA1bI6n2y581WnwOm44B-KTAxhacw2vJY/values/'IGNORER - Données publiques'!A:H?key=AIzaSyAl3TfynOtVS2PQRKyJPWxJShQdESCvsy4");

        if (response.ok) { // if HTTP-status is 200-299
          // get the response body (the method explained below)
          let json = await response.json();
          let organismes = json.values.slice(1);

          // Trouver tous les secteurs
          let secteurs = _.map(organismes, (organisme) => {
            return organisme[0];
          });
          console.log(secteurs);

          // Creer plusieurs tables

          // Ajouter les donnees pour chaque table
          $('#table').DataTable( {
            paging: false,
            data: organismes,
            columns: json.values.slice(0, 1)[0].map((col) => { return {title: col} }),
            "columnDefs": [
              {
                "targets": [0],
                "visible": false,
                "searchable": false
              }
            ],
            language: {
              "sEmptyTable":     "Aucune donnée disponible dans le tableau",
              "sInfo":           "Affichage de l'élément _START_ à _END_ sur _TOTAL_ éléments",
              "sInfoEmpty":      "Affichage de l'élément 0 à 0 sur 0 élément",
              "sInfoFiltered":   "(filtré à partir de _MAX_ éléments au total)",
              "sInfoPostFix":    "",
              "sInfoThousands":  ",",
              "sLengthMenu":     "Afficher _MENU_ éléments",
              "sLoadingRecords": "Chargement...",
              "sProcessing":     "Traitement...",
              "sSearch":         "Rechercher :",
              "sZeroRecords":    "Aucun élément correspondant trouvé",
              "oPaginate": {
                "sFirst":    "Premier",
                "sLast":     "Dernier",
                "sNext":     "Suivant",
                "sPrevious": "Précédent"
              },
              "oAria": {
                "sSortAscending":  ": activer pour trier la colonne par ordre croissant",
                "sSortDescending": ": activer pour trier la colonne par ordre décroissant"
              },
              "select": {
                "rows": {
                  "_": "%d lignes sélectionnées",
                  "0": "Aucune ligne sélectionnée",
                  "1": "1 ligne sélectionnée"
                } 
              }
            }
        });
      } else {
        alert("HTTP-Error: " + response.status);
      }
    }
  </script>
  </body>
</html>
